# Assignment 2.13 — PostgreSQL Schema Design

**Assignment name:** PostgreSQL Schema Design  
**Concept:** Brain 2.13  
**Deliverables:** Normalized schema (Prisma), migrations, seed data, README documentation.

---

## Git / Bash commands (for later reference)

### Branch and PR workflow
```bash
# Create feature branch for this assignment
git checkout -b feature/postgresql-schema-design

# Stage schema, migrations, seed, and docs
git add prisma/ package.json README.md assignments/

# Commit
git commit -m "feat: add PostgreSQL schema design (Prisma) - Assignment 2.13"

# Push and open PR (replace origin/main with your base branch if different)
git push -u origin feature/postgresql-schema-design
# Then create PR: feature/postgresql-schema-design -> main
```

### After PR merge (optional)
```bash
git checkout main
git pull origin main
git branch -d feature/postgresql-schema-design
```

---

## Project commands used for this assignment

### Install dependencies (run once)
```bash
npm install
```

### Database: generate client, migrate, seed, studio
```bash
# Generate Prisma Client (after schema change)
npm run db:generate

# Run migrations (creates DB tables) — use when DB is running (e.g. Docker)
npx prisma migrate dev --name init_schema

# Seed database with sample data
npm run db:seed

# Open Prisma Studio to verify tables and data
npm run db:studio
```

### Using Docker for PostgreSQL
```bash
# Start DB (and app, redis) so migrations can run
docker compose up -d db

# Then run migrations (DATABASE_URL in .env must point to DB; use host "db" for Docker)
npx prisma migrate dev --name init_schema
npm run db:seed
npm run db:studio
```
**Note:** If you get "Can't reach database server at db:5432", start the DB first with `docker compose up -d db`. For local PostgreSQL (no Docker), set `DATABASE_URL` to `postgresql://postgres:password@localhost:5432/mydb` and run migrate.

### Verify migrations and seed
```bash
npx prisma migrate status
npm run db:seed
npx prisma studio
# Check: users, locations, user_location_subscriptions, alerts, flood_readings
```

---

## Files added/updated (for PR description)

| Path | Description |
|------|-------------|
| `prisma/schema.prisma` | Entity definitions, relations, indexes, enums |
| `prisma/seed.js` | Seed script for sample users, locations, subscriptions, alerts, readings |
| `prisma/migrations/*` | Migration SQL (created when you run `npx prisma migrate dev --name init_schema`) |
| `src/lib/prisma.ts` | Prisma Client singleton for use in the app |
| `package.json` | Added `@prisma/client`, `prisma`, db scripts, seed config |
| `README.md` | PostgreSQL Schema Design section |
| `assignments/2.13-postgresql-schema-design.md` | This file — assignment + git commands |

---

## Quick reference: which PR / which commands

| Assignment / PR | Main commands |
|----------------|----------------|
| **2.12 Docker & Compose** | `docker compose pull`, `docker compose up --build`, `docker ps` |
| **2.13 PostgreSQL Schema Design** | `npm run db:generate`, `npx prisma migrate dev --name init_schema`, `npm run db:seed`, `npm run db:studio` |
| **2.14 Prisma ORM Setup** | `npm run db:generate`, `npm run dev`, open `http://localhost:3000/api/users` to verify connection |
